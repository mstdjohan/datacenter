<!DOCTYPE html>
<html>
<head>
  <title>CAKE/IDR Signals</title>
</head>
<body>
  <h2>Signal Trading CAKE/IDR (Indodax)</h2>
  <div id="price">Loading...</div>
  <div id="signal">Waiting signal...</div>

  <script>
    let prices = [];

    async function getPrice() {
      try {
        // ganti cakeusdt -> cake_idr
        let res = await fetch("https://indodax.com/api/ticker/cake_idr");
        let data = await res.json();

        if (!data.ticker || !data.ticker.last) {
          throw new Error("Invalid response: " + JSON.stringify(data));
        }

        let price = parseFloat(data.ticker.last);
        prices.push(price);

        if (prices.length > 100) prices.shift();

        document.getElementById("price").innerText = "Last Price: " + price + " IDR";

        if (prices.length >= 20) {
          let avg = prices.reduce((a, b) => a + b, 0) / prices.length;
          let variance = prices.reduce((a, b) => a + Math.pow(b - avg, 2), 0) / prices.length;
          let stdev = Math.sqrt(variance);
          let upper = avg + 2 * stdev;
          let lower = avg - 2 * stdev;

          let signal = "HOLD";
          if (price > upper) {
            signal = "SELL ðŸš¨ (tembus resistance)";
          } else if (price < lower) {
            signal = "BUY âœ… (tembus support)";
          }

          document.getElementById("signal").innerText = "Signal: " + signal;
        }

      } catch (err) {
        document.getElementById("price").innerText = "Error: " + err;
      }
    }

    getPrice();
    setInterval(getPrice, 5000);
  </script>
</body>
</html>
