<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UT Bot Alerts with Binance</title>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
  <style>
    body { background: #121212; color: #fff; font-family: Arial; }
    #chart { height: 500px; }
    #controls { margin: 10px; }
    select { padding: 5px; }
  </style>
</head>
<body>
  <h2>UT Bot Alerts + Binance Live Data</h2>
  <div id="controls">
    <label>Timeframe: </label>
    <select id="timeframe">
      <option value="1m">1m</option>
      <option value="5m">5m</option>
      <option value="15m">15m</option>
      <option value="1h">1h</option>
      <option value="4h">4h</option>
      <option value="1d">1d</option>
    </select>
  </div>
  <div id="chart"></div>

  <script>
    emailjs.init("YOUR_USER_ID"); // Ganti dengan user_id EmailJS

    const chart = LightweightCharts.createChart(document.getElementById("chart"), {
      layout: { background: { color: '#121212' }, textColor: '#DDD' },
      grid: { vertLines: { color: '#333' }, horzLines: { color: '#333' } },
      timeScale: { timeVisible: true, secondsVisible: false }
    });
    const candleSeries = chart.addCandlestickSeries();

    async function fetchData(symbol="BTCUSDT", interval="1m") {
      const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=500`;
      const data = await fetch(url).then(r => r.json());
      return data.map(d => ({
        time: d[0] / 1000,
        open: parseFloat(d[1]),
        high: parseFloat(d[2]),
        low: parseFloat(d[3]),
        close: parseFloat(d[4])
      }));
    }

    function UTBot(data, atrPeriod=10, factor=1) {
      let signals = [];
      for (let i = atrPeriod; i < data.length; i++) {
        let close = data[i].close;
        let prevClose = data[i-1].close;
        if (close > prevClose * (1 + factor/100)) {
          signals.push({ time: data[i].time, signal: "BUY" });
        } else if (close < prevClose * (1 - factor/100)) {
          signals.push({ time: data[i].time, signal: "SELL" });
        }
      }
      return signals;
    }

    function sendEmailAlert(signal, price) {
      emailjs.send("YOUR_SERVICE_ID","YOUR_TEMPLATE_ID",{
        signal: signal,
        price: price
      }).then(() => console.log("Email sent!"));
    }

    async function loadChart(interval="1m") {
      const data = await fetchData("BTCUSDT", interval);
      candleSeries.setData(data);

      const signals = UTBot(data);
      if (signals.length > 0) {
        let lastSignal = signals[signals.length-1];
        sendEmailAlert(lastSignal.signal, data[data.length-1].close);
      }
    }

    document.getElementById("timeframe").addEventListener("change", e => {
      loadChart(e.target.value);
    });

    loadChart(); // Initial load
  </script>
</body>
</html>
