<!DOCTYPE html>
<html>
<head>
  <title>XRP/USDT Signal Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.0.0/dist/browser.js"></script>
  <style>
    body { font-family: sans-serif; background: #000; color: #fff; text-align: center; }
    #chart-container { width: 90vw; height: 60vh; margin: auto; }
    .signal { font-size: 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>XRP/USDT - Sinyal RSI + MACD</h2>
  <div id="chart-container">
    <canvas id="priceChart"></canvas>
  </div>
  <div class="signal" id="signalResult">‚è≥ Menunggu sinyal...</div>

  <script>
    const API_URL = "https://api.dexscreener.com/latest/dex/pairs/solana/9xyRr3SufCL3gFfRZr6dN8hSScJreUeXzqThDLfyCFPb"; // GANTI DENGAN PAIR YANG VALID
    const priceData = [];
    const labels = [];
    
    const res = await fetch("https://api.coingecko.com/api/v3/coins/ripple/market_chart?vs_currency=usd&days=30");
    const data = await res.json();
    data.prices.forEach(p => {
      priceData.push(p[1]);
      const date = new Date(p[0]);
      timeLabels.push(`${date.getMonth()+1}/${date.getDate()}`);
    

    const chart = new Chart(document.getElementById('priceChart'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'XRP/USDT',
          data: priceData,
          borderColor: '#0f0',
          borderWidth: 2,
          pointRadius: 1,
        }]
      },
      options: {
        scales: {
          x: { ticks: { color: '#aaa' } },
          y: { ticks: { color: '#aaa' } }
        }
      }
    });

    async function fetchPrice() {
      try {
        const res = await fetch(API_URL);
        const json = await res.json();
        const price = parseFloat(json.pair.priceUsd);

        const now = new Date().toLocaleTimeString();
        labels.push(now);
        priceData.push(price);
        if (labels.length > 50) {
          labels.shift();
          priceData.shift();
        }
        chart.update();

        checkSignals();
      } catch (e) {
        console.error("Gagal ambil data:", e);
        document.getElementById('signalResult').textContent = "‚ùå Gagal ambil data. Cek koneksi atau Pair ID!";
      }
    }

    function checkSignals() {
      if (priceData.length < 26) {
        document.getElementById('signalResult').textContent = "‚è≥ Menunggu cukup data...";
        return;
      }

      const rsi = technicalindicators.RSI.calculate({
        values: priceData,
        period: 14
      });

      const macd = technicalindicators.MACD.calculate({
        values: priceData,
        fastPeriod: 12,
        slowPeriod: 26,
        signalPeriod: 9,
        SimpleMAOscillator: false,
        SimpleMASignal: false
      });

      if (rsi.length === 0 || macd.length === 0) {
        document.getElementById('signalResult').textContent = "‚è≥ Data indikator belum cukup...";
        return;
      }

      const lastRSI = rsi[rsi.length - 1];
      const lastMACD = macd[macd.length - 1];

      let signalText = "‚è≥ Menunggu sinyal...";
      if (lastRSI < 30 && lastMACD.histogram > 0) {
        signalText = "üü¢ BUY signal - RSI rendah & MACD positif";
      } else if (lastRSI > 70 && lastMACD.histogram < 0) {
        signalText = "üî¥ SELL signal - RSI tinggi & MACD negatif";
      }
      document.getElementById('signalResult').textContent = signalText;
    }

    fetchPrice(); // Panggil pertama kali
    setInterval(fetchPrice, 30000); // setiap 30 detik
  </script>
</body>
</html>
