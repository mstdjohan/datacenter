<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Manual Trade (Trust Wallet) — Real-time</title>
  <style>
    :root{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{background:#0f1724;color:#e6eef8;margin:0;padding:24px;}
    .card{background:linear-gradient(180deg,#0b1220, #07101a);border:1px solid rgba(255,255,255,0.04);padding:18px;border-radius:12px;max-width:920px;margin:16px auto}
    h1{margin:0 0 12px 0;font-size:20px}
    label{display:block;margin-top:10px;font-size:13px;color:#9fb0d0}
    input,select,button,textarea{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .muted{color:#8da3c7;font-size:13px}
    pre{white-space:pre-wrap;word-break:break-word}
    @media(max-width:880px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="card">
    <h1>Manual Trade — Connect Trust Wallet (WalletConnect)</h1>
    <div class="muted">UI untuk transfer native dan ERC20 dengan WalletConnect. XRP native tidak didukung langsung di EVM.</div>
    <label>Wallet</label>
    <div class="row">
      <div class="col"><input id="address" placeholder="Belum terhubung" readonly /></div>
      <div style="width:140px"><button id="btnConnect">Connect</button></div>
    </div>
    <label>Jenis Transaksi</label>
    <select id="txType">
      <option value="eth_transfer">ETH / Native Transfer</option>
      <option value="erc20_transfer">ERC-20 Transfer</option>
    </select>
    <label id="tokenLabel">To Address / Token Contract</label>
    <input id="to" placeholder="Recipient address" />
    <label>Amount</label>
    <input id="amount" placeholder="Jumlah" />
    <button id="btnPreview">Preview & Sign</button>
    <button id="btnSend">Send Transaction</button>
    <pre id="log">— ready —</pre>
  </div>

  <!-- Load libraries terlebih dahulu -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3modal@1.9.12/dist/index.js"></script>

  <!-- Script utama -->
  <script>
  window.addEventListener('load', function () {
    const logEl = document.getElementById('log');
    function log(msg) {
      console.log(msg);
      logEl.textContent = new Date().toLocaleTimeString() + ' — ' + msg + '\n' + logEl.textContent;
    }

    if (typeof ethers === 'undefined') {
      log('⚠️ ethers.js gagal dimuat. Pastikan koneksi internet aktif & CDN bisa diakses.');
      return;
    }

    let provider, web3Provider, signer;

    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider.default,
        options: {
          rpc: {
            1: 'https://rpc.ankr.com/eth',
            56: 'https://bsc-dataseed.binance.org/',
            137: 'https://rpc.ankr.com/polygon'
          }
        }
      }
    };

    const web3Modal = new window.Web3Modal.default({
      cacheProvider: false,
      providerOptions
    });

    async function connectWallet() {
      try {
        provider = await web3Modal.connect();
        web3Provider = new ethers.providers.Web3Provider(provider);
        signer = web3Provider.getSigner();
        const addr = await signer.getAddress();
        document.getElementById('address').value = addr;
        log('Wallet connected: ' + addr);
      } catch (e) {
        log('connect error: ' + e);
      }
    }

    document.getElementById('btnConnect').addEventListener('click', connectWallet);
  });
  </script>
</body>
</html>
