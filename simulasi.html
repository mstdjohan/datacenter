<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Auto Scalping CAKE/USDT</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    .log { background: #fff; padding: 10px; border-radius: 5px; height: 300px; overflow-y: auto; }
    .price { font-size: 1.5em; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>üöÄ Auto Scalping CAKE/USDT</h2>
  <div class="price" id="livePrice">Harga: Memuat...</div>
  <div class="log" id="logBox">Log strategi akan muncul di sini...</div>

  <script>
    // Inisialisasi EmailJS
    emailjs.init("OGH12a8LlCboHPVz8"); // Public Key kamu

    let lastBuy = null;
    let modal = 100;
    const logBox = document.getElementById("logBox");

    function log(msg) {
      const time = new Date().toLocaleTimeString();
      logBox.textContent += `[${time}] ${msg}\n`;
      logBox.scrollTop = logBox.scrollHeight;
    }

    function kirimEmail(subject, pesan) {
      emailjs.send("service_5hxo1hk", "template_iq87egh", {
        subject: subject,
        message: pesan
      }).then(() => {
        log("üì© Email notifikasi dikirim.");
      }).catch((err) => {
        log("‚ùå Gagal kirim email: " + err.text);
      });
    }

    async function ambilHarga() {
      try {
        const res = await fetch("https://api.dexscreener.com/latest/dex/pairs/bsc/0x0ed7e52944161450477ee417de9cd3a859b14fd0");
        const data = await res.json();
        const harga = parseFloat(data.pair.priceUsd);
        document.getElementById("livePrice").textContent = `Harga: $${harga.toFixed(4)}`;
        return harga;
      } catch (err) {
        log("‚ùå Gagal ambil harga: " + err.message);
        return 0;
      }
    }

    async function strategiOtomatis() {
      const harga = await ambilHarga();
      if (harga === 0) return;

      if (!lastBuy) {
        lastBuy = harga;
        log(`Strategi: BUY üü¢ di $${harga.toFixed(4)}`);
        kirimEmail("Sinyal BUY - CAKE/USDT", `BUY di harga $${harga.toFixed(4)}`);
      } else {
        const selisih = harga - lastBuy;
        const profit = selisih * (modal / lastBuy);
        const persen = (profit / modal) * 100;

        if (selisih > 0.01) {
          log(`Strategi: SELL üî¥ di $${harga.toFixed(4)} | Profit $${profit.toFixed(2)} (${persen.toFixed(2)}%)`);
          kirimEmail("Sinyal SELL - CAKE/USDT", `SELL di harga $${harga.toFixed(4)} | Profit: $${profit.toFixed(2)} (${persen.toFixed(2)}%)`);
          lastBuy = null;
        } else {
          log(`WAIT ‚è≥ di $${harga.toFixed(4)} | Belum cukup untung`);
        }
      }
    }

    // Jalankan pertama kali dan setiap 30 detik
    strategiOtomatis();
    setInterval(strategiOtomatis, 30000);
  </script>
</body>
</html>
